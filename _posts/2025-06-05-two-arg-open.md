---
layout: post
published: true
toc: true
title: "Are you still using the 2-argument open?"
date: 2025-06-05 12:00:00 +0100
tags: authors guides cpan modules security
author: Robert Rothenberg
excerpt: "The 2-argument open function is insecure"
---

The 2-argument [open](https://metacpan.org/pod/perlfunc#open) function is insecure, because the filename can include the mode.
If it is not properly validated, then files can be modified, truncated or a pipe to run an external command:

    $file = "| echo Aha";
    open my $fh, $file;

Even when the filename is generated by your code, you can run into unexpected edge cases.
For example, in a Unix shell run the command

    touch '| echo Aha'

and in the same directory run the script

    opendir( my $dh, ".");
    while (my $file = readdir $dh) {
        next if -d $file;
        open my $fh, $file;
        close $fh;
    }

This is the same [bug](https://rt.cpan.org/Ticket/Display.html?id=64504) in [File::Find::Rule](https://metacpan.org/dist/File-Find-Rule) that became [CVE-2011-10007](https://lists.security.metacpan.org/cve-announce/msg/30183067/).
(If you haven't already upgraded File::Find::Rule to version 0.35 or later, please do so. That module as more than 1,700 direct or indirect dependents.)

The fix is simply to use a 3-argument form, where the second argument is the mode and the third is the filename:

    open my $fh, '<', $file;

The 3-argument open has been supported since [Perl v5.6.0](https://metacpan.org/release/GSAR/perl-5.6.0/view/pod/perldelta.pod#open()-with-more-than-two-arguments), so there is no worry about supporting older versions of Perl.

You can identify this issue in your code using the [Perl::Critic](https://metacpan.org/dist/Perl-Critic) [ProhibitTwoArgOpen](https://metacpan.org/pod/Perl::Critic::Policy::InputOutput::ProhibitTwoArgOpen) policy.
There is a similar policy in [Perl::Lint](https://metacpan.org/dist/Perl-Lint).
