From be7d91e8446ad8013b08b4be313d666dab003a8a Mon Sep 17 00:00:00 2001
From: Robert Rothenberg <rrwo@cpan.org>
Date: Tue, 27 May 2025 14:56:35 +0100
Subject: [PATCH] Disallow IPv4 addresses with leading 0s in the quads

This is a security issue for other modules such as Net::CIDR::Lite,
where the leading zero causes the address to be treated as octal.

Although the issue does not seem to affect this module, the code comes
from Net::CIDR::Lite so the corresponding fix has been incorporated as a
precaution.
---
 lib/Net/CIDR/Set/IPv4.pm | 2 +-
 lib/Net/CIDR/Set/IPv6.pm | 2 +-
 3 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/lib/Net/CIDR/Set/IPv4.pm b/lib/Net/CIDR/Set/IPv4.pm
index 7c007ac..a0b2ca6 100644
--- a/lib/Net/CIDR/Set/IPv4.pm
+++ b/lib/Net/CIDR/Set/IPv4.pm
@@ -22,7 +22,7 @@ sub _pack {
   my @nums = split /[.]/, shift, -1;
   return unless @nums == 4;
   for ( @nums ) {
-    return unless /^\d{1,3}$/ and $_ < 256;
+    return unless /^\d{1,3}$/ and !/^0\d{1,2}$/ and $_ < 256;
   }
   return pack "CC*", 0, @nums;
 }
diff --git a/lib/Net/CIDR/Set/IPv6.pm b/lib/Net/CIDR/Set/IPv6.pm
index 9ebd7ca..cef4596 100644
--- a/lib/Net/CIDR/Set/IPv6.pm
+++ b/lib/Net/CIDR/Set/IPv6.pm
@@ -22,7 +22,7 @@ sub _pack_ipv4 {
   my @nums = split /[.]/, shift, -1;
   return unless @nums == 4;
   for ( @nums ) {
-    return unless /^\d{1,3}$/ and $_ < 256;
+    return unless /^\d{1,3}$/ and !/^0\d{1,2}$/ and $_ < 256;
   }
   return pack "CC*", 0, @nums;
 }
